<?php
	$goTo = new GetModel();
	$account_id = $goTo -> getAdminIdByUsernameAndPassword($_SESSION['adminUsername'], $_SESSION['adminPassword']);
	
	$fname = $_GET['fname'];
	$lname = $_GET['lname'];
	$mname = $_GET['mname'];
?>

<header id='accounttitle'>
	<p>Change Password</p>
</header>
<ul id='accountlink'>
	<li class='admininfo' style='color: #fff;'><strong>Change Password for : </strong> <?php echo strtoupper($lname).', '.$fname.' '.substr($mname,0,1).'.'; ?> </li>
</ul>
</br>
<table id='accountpasswordusername'>
	<form method='POST'>
		<tr>
			<td>Current password &nbsp;</td>
			<td><input class='input' type='password' name='c_password' size='26' placeholder='Type your Password' autofocus required/></td>
		</tr>
		
		<tr>
			<td>New password &nbsp;</td>
			<td><input class='input' type='password' name='n_password' size='26' placeholder='New Password' autofocus required/></td>
		</tr>
		
		<tr>
			<td>Confirm password &nbsp;</td>
			<td><input class='input' type='password' name='c_n_password' size='26' placeholder='Confirm Password'autofocus required/></td>
		</tr>
		
		<tr>
			<td colspan='2'>
				<input type='submit' name='cancel' value='CANCEL' class='inputbutton' formnovalidate/>
				<input type='submit' name='save' value='SAVE' class='inputbutton' />
			</td>
		</tr>
	</form>
</table>
<?php
	if (isset($_POST['save'])){
		
		# Verify if typed current password is equals to original password:
			if($_POST['c_password'] == $_SESSION['adminPassword']) {
			
				# Verify if new password is equals to new password2:
				if($_POST['n_password'] == $_POST['c_n_password']) {
				
					# Verify if new password is equal to original password:
					if($_POST['n_password'] == $_POST['c_password']) {
					
						# Nothing changes:
						echo "<script>adminPasswordChanged()</script>";
					} else {
					
						# New password is not equals to original password:
						$goTo = new VerifyModel();
						$is_not_being_used = $goTo -> verify_if_password_is_not_being_used($_POST['n_password']);
						
						# Verify if new password is not being used:
						if($is_not_being_used) {
						
							$password = $_POST['n_password'];
						
							$is_updated = $query = mysql_query("UPDATE account SET password = '$password' WHERE accountID = '$accountID'");
							
							if($is_updated) {
							
								$_SESSION['adminPassword'] = $password;
							
								echo "<script>adminPasswordChanged()</script>";
							}
						} else {
							# New password is being used (Print error message):
							echo "<script>alert('Password is already being used!');</script>";
							# echo "<div class='alert'><p>Password is already being used!</p></div>";
						}
					}
				} else {
					# Typed new passwords are not equals (Print error message):
					echo "<script>alert('Password do not match!');</script>";
					# echo "<div class='alert'><p>Password do not match!</p></div>";
				}
			} else {
				# typed current password is not equals to original password (Print error message):
				echo "<script>alert('Current password is invalid!');</script>";
				# echo "<div class='alert'><p>Current password is invalid!</p></div>";
			}
	}else if (isset($_POST['cancel'])) {
		echo "<script>goToAdmin()</script>";
	}
?>