<?php
	$goTo = new GetModel();

if(isset($_GET['employeeID'])){
  $result = $goTo -> getAccountInfo($_GET['employeeID']);
  
  foreach ($result as $info){
    $fname = $info['fname'];
    $mname = $info['mname'];
    $lname = $info['mname'];
    $username = $info['username'];
    $userID = $info['userID'];
  }


    }

      

?>

<header id='accounttitle'>
	<p>Change Username</p>
</header>
<ul id='accountlink'>
  <li class='admininfo' style='color: #fff;'><strong>Change Username for : <?php echo $lname.", ".$fname." ".$mname?> </li>
</ul>
</br>
<table id='accountpasswordusername'>
	<form method='POST'>
		<tr>
			<td>Username &nbsp;</td>
			<td><input class='input' disabled='true' type='text' name='o_username' size='26' value='<?php echo $_SESSION['adminUsername']; ?>'/></td>
		</tr>
		
		<tr>
			<td>New Username &nbsp;</td>
			<td><input class='input' type='text' name='n_username' size='26' placeholder='New Username' autofocus required/></td>
		</tr>
		
		<tr>
			<td colspan='2'>
				<input type='submit' name='cancel' value='CANCEL' class='inputbutton' formnovalidate/>
				<input type='submit' name='save' value='SAVE' class='inputbutton' />
			</td>
		</tr>
	</form>
</table>
<?php
	if (isset($_POST['save'])){
	
		if($_SESSION['adminUsername'] == $_POST['n_username']) {
		
			echo "<script>adminAccountUpdated()</script>";
		} else {
		
			$goTo = new VerifyModel();
			$is_not_being_used = $goTo -> verify_if_password_is_not_being_used($_POST['n_username']);
			
			if($is_not_being_used) {
			
				$username = $_POST['n_username'];
				$admin_id = $userID;
				$is_updated = mysql_query("UPDATE account SET username = '$username' WHERE account_id = '$admin_id'");
				
				if($is_updated) {
				
					$_SESSION['adminUsername'] = $username;
				
					echo "<script>adminAccountUpdated()</script>";
				}
			} else {
				echo "<script>alert('Username is already in use!');</script>";
			}
		}
	}else if (isset($_POST['cancel'])) {
		echo "<script>goToAdmin()</script>";
	}
?>